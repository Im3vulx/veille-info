{% extends 'base.html.twig' %}

{% block title %}Neurogameron - Mes favoris
{% endblock %}

{% block body %}
	<section class="hero-banner2">
		<div class="container">
			<div class="icon">
				<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 640"><path d="M305 151.1L320 171.8L335 151.1C360 116.5 400.2 96 442.9 96C516.4 96 576 155.6 576 229.1L576 231.7C576 343.9 436.1 474.2 363.1 529.9C350.7 539.3 335.5 544 320 544C304.5 544 289.2 539.4 276.9 529.9C203.9 474.2 64 343.9 64 231.7L64 229.1C64 155.6 123.6 96 197.1 96C239.8 96 280 116.5 305 151.1z"/></svg>
			</div>
			<div class="title">
				<h1>Mes favoris</h1>
				<p>Nombre de favoris :
					{{ favorites|length }}</p>
			</div>
		</div>
	</section>

	<section id="favorites" data-controller="favorites">
		<section id="filters-search">
			<div class="filters-container">
				<div class="search-input">
					<div class="icon">
						<svg class="icon-search" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 640"><path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/></svg>
					</div>
					<input type="text" name="search" placeholder="Rechercher dans vos favoris..." value="{{ searchTerm }}" data-favorites-target="search" oninput="this.dispatchEvent(new Event('input'))"/>
				</div>

				<div class="selects-container">
					<div class="select-wrapper">
						<select name="category" data-favorites-target="category" onchange="this.dispatchEvent(new Event('change'))">
							<option value="all">Toutes les catégories</option>
							{% for category in categories %}
								<option value="{{ category.id }}" {% if category.id == categoryFilter %} selected {% endif %}>
									{{ category.name }}
								</option>
							{% endfor %}
						</select>
						<div class="icon-filter">
							<svg class="icon-filter-svg" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 640"><path d="M96 128C83.1 128 71.4 135.8 66.4 147.8C61.4 159.8 64.2 173.5 73.4 182.6L256 365.3L256 480C256 488.5 259.4 496.6 265.4 502.6L329.4 566.6C338.6 575.8 352.3 578.5 364.3 573.5C376.3 568.5 384 556.9 384 544L384 365.3L566.6 182.7C575.8 173.5 578.5 159.8 573.5 147.8C568.5 135.8 556.9 128 544 128L96 128z"/></svg>
						</div>
					</div>

					<select name="sort" data-favorites-target="sort" onchange="this.dispatchEvent(new Event('change'))">
						<option value="recent" {% if sortBy == 'recent' %} selected {% endif %}>Plus récents</option>
						<option value="oldest" {% if sortBy == 'oldest' %} selected {% endif %}>Plus anciens</option>
						<option value="title" {% if sortBy == 'title' %} selected {% endif %}>Par titre</option>
					</select>
				</div>
			</div>

			{% if favorites|length > 0 %}
				<form method="post" action="{{ path('app_bookmark_remove_all') }}" class="clear-bookmarks-form" onsubmit="return confirm('Voulez-vous vraiment supprimer tous vos favoris ?');">
					<button type="submit" class="btn-clear-bookmarks">
						<svg class="icon-trash" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 640"><path d="M232.7 69.9C237.1 56.8 249.3 48 263.1 48L377 48C390.8 48 403 56.8 407.4 69.9L416 96L512 96C529.7 96 544 110.3 544 128C544 145.7 529.7 160 512 160L128 160C110.3 160 96 145.7 96 128C96 110.3 110.3 96 128 96L224 96L232.7 69.9zM128 208L512 208L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 208zM216 272C202.7 272 192 282.7 192 296L192 488C192 501.3 202.7 512 216 512C229.3 512 240 501.3 240 488L240 296C240 282.7 229.3 272 216 272zM320 272C306.7 272 296 282.7 296 296L296 488C296 501.3 306.7 512 320 512C333.3 512 344 501.3 344 488L344 296C344 282.7 333.3 272 320 272zM424 272C410.7 272 400 282.7 400 296L400 488C400 501.3 410.7 512 424 512C437.3 512 448 501.3 448 488L448 296C448 282.7 437.3 272 424 272z"/></svg>
						Tout supprimer
					</button>
				</form>
			{% endif %}
		</section>

		<section id="articles">
			<p class="total">{{ favorites|length }}
				résultats</p>

			<div class="articles-grid">
				{% if favorites is empty %}
					<div class="empty-state">
						<div class="empty-icon"></div>
						<h3>Aucun article disponible</h3>
						<p>Il n'y a pas encore d'articles publiés. Revenez bientôt !</p>
					</div>
				{% else %}
					{% for favorite in favorites %}
						{% set article = favorite.article %}
						<article class="article-card" data-favorites-target="article" data-category-id="{{ article.category.id }}" data-created-at="{{ article.createdAt|date('c') }}">
							<div class="trash">
								<form method="post" action="{{ path('app_bookmark_remove', {'id': article.id}) }}" onsubmit="return confirm('Voulez-vous vraiment supprimer ce favori ?');">
									<button type="submit" class="trash-button">
										<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 640 640"><path d="M232.7 69.9C237.1 56.8 249.3 48 263.1 48L377 48C390.8 48 403 56.8 407.4 69.9L416 96L512 96C529.7 96 544 110.3 544 128C544 145.7 529.7 160 512 160L128 160C110.3 160 96 145.7 96 128C96 110.3 110.3 96 128 96L224 96L232.7 69.9zM128 208L512 208L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 208zM216 272C202.7 272 192 282.7 192 296L192 488C192 501.3 202.7 512 216 512C229.3 512 240 501.3 240 488L240 296C240 282.7 229.3 272 216 272zM320 272C306.7 272 296 282.7 296 296L296 488C296 501.3 306.7 512 320 512C333.3 512 344 501.3 344 488L344 296C344 282.7 333.3 272 320 272zM424 272C410.7 272 400 282.7 400 296L400 488C400 501.3 410.7 512 424 512C437.3 512 448 501.3 448 488L448 296C448 282.7 437.3 272 424 272z"/></svg>
									</button>
								</form>
							</div>
							{% if article.imageUrl %}
								<div class="article-image">
									<img src="{{ article.imageUrl }}" alt="{{ article.title }}" loading="lazy">
								</div>
							{% endif %}

							<div class="article-content">
								<div class="article-meta">
									<span class="article-category">{{ article.category.name }}</span>
									<span class="article-date">{{ article.createdAt|date('d/m/Y') }}</span>
								</div>

								<h2 class="article-title">
									<a href="{{ path('app_article_show', {id: article.id}) }}">{{ article.title }}</a>
								</h2>

								<p class="article-summary">
									{{ article.summary|length > 150 ? article.summary|slice(0, 150) ~ '...' : article.summary }}
								</p>

								<div class="article-footer">
									{% if article.authorName is not empty %}
										<span class="article-author">Par
											{{ article.authorName }}</span>
									{% endif %}
									<a href="{{ path('app_article_show', {id: article.id}) }}" class="read-more">
										Lire la suite
									</a>
								</div>
							</div>
						</article>
					{% endfor %}
				{% endif %}
			</div>
		</section>
	</section>
	{% include "footer.html.twig" %}
{% endblock %}
